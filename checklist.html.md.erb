---
title: Upgrade Checklist for PCF v2.3
owner: Ops Manager
---

This topic serves as a checklist for upgrading Pivotal Cloud Foundry (PCF) from v2.2 to v2.3.


## <a id="compatibility"></a> Tile Compatibility
 
Before you upgrade to PCF v2.3, please check whether the service tiles that you currently have deployed on PCF v2.2 are compatible with PCF v2.3.

To check PCF versions supported by a service tile, either from Pivotal or a Pivotal partner:

* Navigate to the tile's download page on [Pivotal Network](https://network.pivotal.io).
* Select the tile version in the **Releases** dropdown.
* See the **Depends On** section under **Release Details**. For more information, refer to the tile's release notes.

If the currently-deployed version of a tile is not compatible with PCF v2.3, you must upgrade the tile to a compatible version before you upgrade PCF. You do not need to upgrade tiles that are compatible with both PCF v2.2 and v2.3. 

Some partner service tiles may be incompatible with PCF v2.3. Pivotal works with partners to ensure their tiles are updated to work with the latest versions of PCF. For more information about which partner service release compatibility, review the **Depends On** section of the partners tile download page, the partners services release documentation in [Pivotal Documentation](https://docs.pivotal.io), or contact the partner organization that produces the service tile.

<p class="note breaking"><strong>Warning: </strong>Some tiles released with PCF v2.3 require a new Xenial stemcell. Before deploying tiles that use Xenial, you must update any BOSH add-ons used in your deployment to include Xenial stemcells and add a Xenial stemcell to your stemcell library in Ops Manager. For more information, see <a href="../customizing/upgrading-pcf.html#stemcell-compat">Check OS Compatibility of BOSH-Managed Add-Ons and Tiles</a>.</p>

The [Product Compatibility Matrix](
http://docs.pivotal.io/resources/product-compatibility-matrix.pdf) provides an overview of which PCF versions support which versions of the most popular service tiles from Pivotal.

When you have completed your upgrade please take some time to complete [this survey](https://docs.google.com/forms/d/e/1FAIpQLScf9KuTbF3B9CjldMGqQxF-GA72xMR0DGzaGmhX4uWMrD8pOA/viewform?c=0&w=1).


## <a id="env"></a> Environment Details

Pivotal provides the empty table below as a model to print out or adapt for recording and tracking the tile versions that you have deployed in all of your environments.

|                                                                         |                                                                  | **Sandbox** | **Non-Prod** | **Prod** | **Other...** |
| ----------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------ | ------------- | -------- | ------------ |
| **Pivotal Cloud Foundry**                                                   | [Ops Manager](https://network.pivotal.io/products/ops-manager) |              |               |          |              |
|                                                                         | [Pivotal Application Service](https://network.pivotal.io/products/elastic-runtime) (PAS)     |              |               |          |              |
| **Pivotal Cloud Foundry Services**         | [MySQL v2](https://network.pivotal.io/products/pivotal-mysql)                                                            |              |               |          |              |
|                                                                         | [Redis](https://network.pivotal.io/products/p-redis)                                                            |              |               |          |              |
|                                                                         | [RabbitMQ](https://network.pivotal.io/products/p-rabbitmq)                                                         |              |               |          |              |
|                                                                         | [Single Sign On](https://network.pivotal.io/products/p-identity) (SSO)                                                              |              |               |          |              |
|                                                                         | [Spring Cloud Services](https://network.pivotal.io/products/p-spring-cloud-services)                                            |              |               |          |              |
|                                                                         | [Concourse](https://network.pivotal.io/products/p-concourse)                                                        |              |               |          |              |
|                                                                         | ...                                                              |              |               |          |              |
| **Pivotal Cloud Foundry Partner Services** | [New Relic](https://network.pivotal.io/products/p-new-relic)                                                        |              |               |          |              |
|                                                                         | ...                                                           |              |               |          |              |


## <a id="known-issues"></a> PAS v2.3 Known Issues in the Pivotal Knowledge Base

The following Pivotal Knowledge Base (KB) articles describe known issues for <b>PCF v2.3</b>:

* [PAS backup-prepare job renamed to backup-restore may cause automation failures](https://community.pivotal.io/s/article/PAS-backup-prepare-job-renamed-to-backup-restore-may-cause-automation-failures)
* [Buildpacks are missing or not installed in PAS 2.3](https://community.pivotal.io/s/article/buildpacks-are-missing-or-not-installed-in-pas-2-3)
* [Diego Cell garden healthcheck fails and becomes unhealthy](https://community.pivotal.io/s/article/Diego-Cell-garden-healthcheck-fails-and-becomes-unhealthy)
* [Buildpacks are missing or not installed in PAS 2.3](https://community.pivotal.io/s/article/buildpacks-are-missing-or-not-installed-in-pas-2-3)

## <a id="breaking"></a> PCF v2.3 Breaking Changes 

<b>PCF v2.3</b> has the following breaking changes. For more information, see [PCF v2.3 Breaking Changes](http://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/breaking-changes.html) in the PCF Release Notes.

<table>
<tbody>
<tr>
<th><strong>Breaking Change</strong></th>
<th><strong>Details</strong></th>
</tr>
<tr>
<td>Updates for Xenial Stemcell Support</td>
<td>Starting in PCF v2.3, Ops Manager uses a Xenial stemcell. Also, some tiles released with PCF v2.3 require a new Xenial stemcell. Before deploying tiles that use Xenial, you must update any BOSH add-ons used in your deployment to include Xenial stemcells and add a Xenial stemcell to your stemcell library in Ops Manager. </td>
</tr>
<tr>
<td>BOSH DNS Must be Enabled</td>
<td>In PCF v2.3, you cannot opt out of BOSH DNS. Upgrades to PCF v2.3 will fail if BOSH DNS is disabled in PCF v2.2.</td>
</tr>
<tr>
<td>Downtime when Upgrading on vSphere with NSX-T</td>
<td>
If your PCF deployment is on vSphere and uses NSX-T load balancers, upgrading from PCF v2.2 to PCF v2.3 may cause downtime. This is due to a new feature in the <a href="https://github.com/cloudfoundry-incubator/bosh-vsphere-cpi-release/releases/tag/v48">vSphere CPI</a> that Ops Manager uses, which introduces the capability to manage the full lifecycle of the membership of the NSX-T load balancer. See <a href="https://pivotal-cf-blog-staging.cfapps.io/post/upgrade_2.2-2.3_on_nsx-t/">Safely Upgrading PAS 2.2 → 2.3 with NSX-T Load Balancers</a>.  
</td>
</tr>
<tr>
<td>Ops Manager API Does Not Return Secret Properties</td>
<td>
For security, Ops Manager API responses from the <code>/api/v0/staged/director/properties</code> endpoint no longer includes several secret properties. This change may break any code that relies on retrieving these properties. 
</td>
</tr>
<tr>
<td>Read-Only Volume Mounts</td>
<td>PAS v2.3 incldues a new version of NFS that resolves an incompatibility between the NFS volume release and Diego. However, upgrading PAS does not migrate any existing NFS service bindings to use the new NFS version. As a result, apps with NFS services bound as read-only may crash.</td>
</tr>
<tr>
<td>Mutual TLS App Identity Verification Disables CF SSH and TCP Routing</td>
<td>When you enable the <b>Router and applications use mutual TLS to verify each other’s identity</b> option in PAS v2.3, app containers accept incoming communication only from the Gorouter. This disables <code>cf ssh</code> and TCP routing.

</td>
</tr>
<tr>
<td>backup-prepare Instance Group Has Been Renamed to backup_restore</td>
<td>The name of the <code>backup-prepare</code> instance group has been changed to <code>backup_restore</code>. This may break some external tools that were setting the properties for this instance group through the Ops Manager API. </td>
</tr>
<tr>
<td>GrootFS Must be Enabled</td>
<td>In PCF v2.3, you cannot opt out of GrootFS. Upgrades to PCF v2.3 will fail if GrootFS is disabled in PCF v2.2.</td>
</tr>
<tr>
<td>Introduction of GrootFS may cause Apps Deployed with Docker to Exceed Disk Quota</td>
<td>If you did not enable GrootFS prior to PAS v2.3, you may encounter issues with apps deployed with a Docker image. GrootFS fixes a bug in which disk quotas were not accurately calculated. However, this bug fix may cause Docker images that previously adhered to a quota to now exceed the same quota size. See <a href="https://github.com/cloudfoundry/garden-runc-release/blob/master/docs/migrating-from-garden-shed-to-grootfs.md#disk-quota-calculation">Disk quota calculation</a> in the <code>garden-runc-release</code> repository.</td>
</tr>
<tr>
<td>Encryption between Gorouter and Cloud Controller may cause App Downtime during Upgrade</td>
<td>In PAS v2.3, traffic between the Gorouter and Cloud Controller is encrypted. To prevent app downtime while upgrading from v2.2 to v2.3, you must be running PAS v2.2.4 or later. These versions of PAS v2.2 contain the configuration <code>router.backends.enable_tls: true</code> in the Gorouter manifest.</td>
</tr>
<tr>
<td>Update Runtime Config of ClamAV for PASW v2.3</td>
<td>If you are using the ClamAV Add-on for PCF, you must update your runtime config before upgrading to Pivotal Application Service for Windows (PASW) v2.3. If you upgrade to PASW v2.3 without first updating the runtime config, then your Windows VMs will not be protected by ClamAV. For more information about how to update your runtime config, see <a href="https://docs.pivotal.io/addon-antivirus/1-4/updating-for-pasw.html">Updating ClamAV Add-on for PCF to Run with PAS for Windows v2.3</a> in the ClamAV documentation.</td>
</tr>
</tbody>
</table>


## <a id="before"></a> Before Upgrade

<table>
<tbody>
<tr>
<th><strong>Step</strong></th>
<th><strong>Note/Reason </strong></th>
<th><strong>Product or Component</strong></th>
</tr>
<tr>
<td>Upgrade all service tiles to versions compatible with PCF v2.3.</td>
<td>Review the <a href="http://docs.pivotal.io/resources/product-compatibility-matrix.pdf">Compatibility Matrix</a> and tile documentation to check version compatibility.</td>
<td>Service Tiles </td>
</tr>
<tr>
<td><p>Back up your PCF deployment. See <a href="https://docs.pivotal.io/pivotalcf/2-2/customizing/backup-restore/index.html">Backing Up and Restoring Pivotal Cloud Foundry</a> and <a href="https://docs.pivotal.io/pivotalcf/2-2/customizing/backup-restore/disaster-recovery.html">Disaster Recovery in Pivotal Cloud Foundry</a></p></td>
<td><p>Pivotal recommends backing up your installation settings before upgrading or otherwise changing your PCF deployment.</p></td>
<td>PCF</td>
</tr>
<tr>
<td>Review <a href="https://docs.pivotal.io/pivotalcf/2-3/customizing/upgrading-pcf.html">Upgrading Pivotal Cloud Foundry</a> in the PCF v2.3 documentation and complete all relevant actions</td>
<td><p>Review all of the upgrade notes.</p>
<ul><li>If you disabled BOSH DNS, reenable it.</li>
<li>Ensure that lifecycle errands are enabled for your installed tiles.</li>
<li>Ensure that your persistent disk usage is &lt; 50%.</li>
<li>Ensure that you know your decryption passphrase and have it stored safely.</li></ul></td>
<td>PCF</td>
</tr>
<tr>
<td>Review the <a href="http://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/runtime-rn.html">Pivotal Application Service v2.3 Release Notes</a>.</td>
<td>See the PAS release notes for details.</td>
<td>PAS</td>
</tr>
<tr>
<td>Review the <a href="http://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/opsmanager-rn.html">PCF Ops Manager Release v2.3 Release Notes</a></td>
<td><p>See the Ops Manager release notes for any feature changes that may affect you during or after upgrade.</p>
<p>BOSH CLI output formatting has changed. If your deployment uses scripts that rely on BOSH output, you must update them to interpret <a href="https://bosh.io/docs/cli-v2/">BOSH CLI v2</a> command output</p></td>
<td>Ops Manager</td>
</tr>
<tr>
<td>Review the <a href="https://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/runtime-rn.html">Known Issues</a> section of the PAS v2.3 release notes</td>
<td>This section covers recommended actions, new issues, and existing issues for PAS v2.3.</td>
<td>PAS</td>
</tr>
<tr>
<td>Review the <a href="http://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/opsmanager-rn.html#known-issues">Known Issues</a> section of the Ops Manager v2.3 release notes.</td>
<td>This section covers recommended actions, new issues, and existing issues for Ops Man v2.3</td>
<td>Ops Manager</td>
</tr>
<tr>
<td>Review <a href="http://docs.pivotal.io/pivotalcf/2-3/pcf-release-notes/breaking-changes.html">PCF v2.3 Breaking Changes</a>.</td>
<td>This topic describes the breaking changes you need to be aware of when upgrading PCF v2.3.</td>
<td>PCF</td>
</tr>
<tr>
<td>Review <a href="https://docs.pivotal.io/pivotalcf/2-3/security/networking/diego-network-paths.html">Diego Network Communications</a>.</td>
<td>This topic describes the internal network communication paths between components of <a href="https://docs.pivotal.io/pivotalcf/2-2/concepts/diego/diego-architecture.html">Diego</a> workload management system in PAS.</td>
<td>PAS</td>
</tr>
<tr>
<td><p>Run and collect foundation health status in at least one of the following ways:</p>
<ul>
	<li>If your PCF deployment has external metrics monitoring set up, verify that VM CPU, RAM, and disk use levels are within reasonable levels.</li>
	<li>Run BOSH CLI commands to check system status:
		<ul><li><code>bosh -e ALIAS -d DEPLOYMENT_NAME instances --ps</code></li>
			<li><code>bosh -e ALIAS vms --vitals</code></li>
			<li><code>bosh -e ALIAS -d DEPLOYMENT_NAME cck --report</code></li>
		</ul></li>
	<li>Check Ops Manager GUI each ERT/Tiles the status page for CPU/RAM/DISK utilization</li>
	<li>Validate Ops Manager persistent disk usage is below 50%. If not, follow Prep 6 in the <a href="https://docs.pivotal.io/pivotalcf/2-3/customizing/upgrading-pcf.html#prepare-env">Ops Manager upgrade docs</a>.</li>
</ul>
</td>
<td><p><code>bosh vms --vitals</code> reveals VMs with high CPU, high memory, high disk utilization, and with <code>state</code> != <code>running</code>.</p>
	<p><code>bosh instances</code> with the flags <code>--ps</code>,  <code>--vitals</code>, or <code>--failing</code>highlights individual job failure.</p></li>
</ul>
</td>
<td>PCF</td>
</tr>
<tr>
<td><p>Review <a href="https://docs.pivotal.io/pivotalcf/2-3/monitoring/index.html#new">KPI Changes from PCF v2.2 to v2.3</a>.</p>
	<p>For complete descriptions of each KPI, see <a href="https://docs.pivotal.io/pivotalcf/2-3/monitoring/kpi.html">Key Performance Indicators</a>.</p></td>
<td>This document highlights new and changed Key Performance Indicators (KPIs) that operators may want to monitor with their PCF deployment to help ensure it is in a good operational state.</td>
<td>PAS</td>
</tr>
<tr>
<td><p>Check that Diego cells have sufficient available RAM and disk capacity to support app containers.</p></td>
<td><p>The KPIs that monitor these these resources are are:</p>
<ul><li><code>rep.CapacityRemainingMemory</code></li>
	<li><code>rep.CapacityRemainingDisk</code></li></ul>
<p>Review the <a href="https://docs.pivotal.io/pivotalcf/2-3/monitoring/kpi.html#cell">Diego Cell Metrics</a> section of the KPI topic for more information about these KPIs.</p></td>
<td>PAS</td>
</tr>
<tr>
<td>Check that a test app can be pushed and scaled horizontally, manually or via automated testing.</td>
<td>This check ensures that the platform supports apps as expected before the upgrade.</td>
<td>PCF</td>
</tr>
<tr>
<td>If needed, adjust the maximum number of Diego cells that the platform can upgrade simultaneously, to avoid overloading the other cells. See <a href="https://docs.pivotal.io/pivotalcf/2-3/adminguide/diego-cell-upgrade.html">Managing Diego Cell Limits During Upgrade</a>.</td>
<td>For PCF v1.10 and later, the maximum number of cells that can update at once, <code>max_in_flight</code> is 4%. This setting is configured in the BOSH manifest's Diego cell definition. See the <a href="https://docs.pivotal.io/pivotalcf/2-3/adminguide/diego-cell-upgrade.html#limitations-considerations">Preventing Overload</a> section for details.</td>
<td>PAS</td>
</tr>
<tr>
<td><p>To save upgrade time, you can disable unused PAS post-deploy errands.</p></td>
<td><p>See the <a href="https://docs.pivotal.io/tiledev/2-3/tile-errands.html#post-deploy">Post-Deploy Errands</a> section of the Errands topic for details.</p>
<p>Only disable these errands if your environment does not need them.</p></td>
<td>PAS</td>
</tr>
<tr>
<td><p>If you are running Elastic Runtime MySQL as a cluster, run the <code>mysql-diag</code> tool to validate health of the cluster.</p>
</td>
<td><p>See the BOSH CLI v2 instructions in the <a href="https://docs.pivotal.io/pivotalcf/2-3/pas/mysql-diag.html">Running mysql-diag</a> topic.</p></td>
<td>PAS</td>
</tr>
<tr>
<td>Run <code>bosh -e ALIAS clean-up --all</code> to clean up old stemcells, releases, orphaned disks, and other resources before upgrade.</td>
<td>This cleanup helps prevent the product and stemcell upload process from exceeding the BOSH Director's available persistent disk space.</td>
<td>BOSH</td>
</tr>
</tbody>
</table>


## <a id="during"></a> During Upgrade

<table>
<tbody>
<tr>
<th><strong>Step</strong></th>
<th><strong>Note/Reason </strong></th>
<th><strong>Product/component</strong></th>
</tr>
<tr>
<td>(Optional) Periodically take snapshots of storage metrics</td>
<td>Pivotal recommends this if you have a large foundation and have experienced storage issues in the past.</td>
<td>PCF</td>
</tr>
<tr>
<td><p>Monitor upgrade progress with methods such as:</p>
	<ul><li>Run BOSH CLI status checks: 
		<ul><li><code>bosh -e ALIAS task TASK_NUMBER</code></li>
			<li><code>bosh -e ALIAS vms --vitals, bosh -e ALIAS instances --ps</code></li></ul></li>
	<li>Check app availability</li>
	<li>Run cf CLI Commands</li>
	<li>Check the availability of the Ops Manager GUI</li>
	<li>Check NAS performance (if using NAS)</li>
	<li>Check vSphere performance (if on vSphere)</li></ul></td>
<td>Monitor the progress of the upgrade, checking the status of the foundation at various locations.</td>
<td>PCF</td>
</tr>
<tr>
<td><p>Use the CF Diego Operator Toolkit (cfdot) to check Diego component instance count by current state.</p></td>
<td>See the <a href="https://github.com/cloudfoundry/cfdot">cfdot documentation</a> on github for details.</td>
<td>PAS</td>
</tr>
<tr>
<td><p>(Optional) If you encounter problems during upgrade, collect the following information:</p>
<ul><li>All job logs</li>
<li>Task debug logs for VM upgrade tasks</li>
<li>Installation log from Ops Manager</li></ul></td>
<td>This information helps determine the cause of upgrade issues.</td>
<td>PCF</td>
</tr>
</tbody>
</table>


## <a id="after"></a> After Upgrade

<table>
<tbody>
<tr>
<th><strong>Step</strong></th>
<th><strong>Note/Reason </strong></th>
<th><strong>Product/component</strong></th>
</tr>
<tr>
<td>Complete the steps in the <a href="https://docs.pivotal.io/pivotalcf/2-3/customizing/upgrading-pcf.html#after-upgrade">After You Upgrade</a> section of the Upgrading Pivotal Cloud Foundry topic.</td>
<td>This ensures that you have the latest version of the Cloud Foundry Command Line Interface (cf CLI).</td>
<td>ALL</td>
</tr>
<tr>
<td>Push and horizontally scale a test application.</td>
<td>This is a performance test for PAS.</td>
<td>PCF</td>
</tr>
<tr>
<td><p>Re-create your alias using BOSH:</p>
<p><code>bosh alias-env ALIAS -e DIRECTOR_IP</code></p></td>
<td>To log into BOSH after upgrading PCF, you need to recreate your alias.</td>
<td>BOSH</td>
</tr>
<tr>
<td>Run BOSH CLI commands to check system status:
<ul><li><code>bosh -e ALIAS -d DEPLOYMENT_NAME instances --ps</code></li>
<li><code>bosh -e ALIAS vms --vitals</code></li>
<li><code>bosh -e ALIAS -d DEPLOYMENT_NAME cck --report</code></li></ul>
</td>
<td>To ensure that all jobs and process are running as expected.</td>
<td>PCF and all tiles</td>
</tr>
<tr>
<td>If you added custom <strong>VM Type</strong> or <strong>Persistent Disk Type</strong> options, ensure that these values are correctly set and were not overwritten.</td>
<td>Verify that the Ops Manager <strong>Resource Config</strong> pane still lists your custom options.</td>
<td>PCF</td>
</tr>
<tr>
<td><p>If you are running PAS MySQL as a cluster, run the <code>mysql-diag</code> tool to validate health of the cluster.</p>
</td>
<td><p>See the BOSH CLI v2 instructions in the <a href="https://docs.pivotal.io/pivotalcf/2-3/pas/mysql-diag.html">Running mysql-diag</a> topic.</p></td>
<td>PAS</td>
</tr>
<tr>
<td>Run <code>bosh -e ALIAS clean-up --all</code> to clean up old stemcells, releases, orphaned disks, and other unused resources.</td>
<td></td>
<td>Tiles</td>
</tr>
</tbody>
</table>


## <a id="survey"></a> Survey

Please take some time to help us improve this document by completing the [Upgrade Checklist Survey](https://docs.google.com/forms/d/e/1FAIpQLScf9KuTbF3B9CjldMGqQxF-GA72xMR0DGzaGmhX4uWMrD8pOA/viewform?c=0&w=1).